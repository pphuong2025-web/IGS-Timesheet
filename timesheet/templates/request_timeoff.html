{% extends "base.html" %}
{% block title %}Request time off{% endblock %}

{% block content %}
<h1>Request time off</h1>
<p style="color: var(--text-muted); margin-bottom: 1rem;">Submit time off for a date range. Select the type (Sick leave, PTO, or Non Pay). Non Pay does not add hours. Your request is stored and the status box below updates when Administrator approves or disapproves.</p>

{% for msg in get_flashed_messages() %}
<p class="flash success">{{ msg }}</p>
{% endfor %}
{% if error %}
<p class="flash error">{{ error }}</p>
{% endif %}

<form method="post" action="{{ url_for('request_timeoff') }}" style="max-width: 28rem;">
  <div class="form-group">
    <label for="from_date">From date</label>
    <input type="date" id="from_date" name="from_date" required>
  </div>
  <div class="form-group">
    <label for="to_date">To date</label>
    <input type="date" id="to_date" name="to_date" required>
  </div>
  <div class="form-group">
    <label for="notes">Type</label>
    <select id="notes" name="notes" required style="width: 100%;">
      <option value="">— Select —</option>
      {% for t in timeoff_types %}
      <option value="{{ t }}">{{ t }}</option>
      {% endfor %}
    </select>
  </div>
  <button type="submit" class="btn">Submit time off</button>
</form>

<div style="margin-top: 1.5rem; padding: 1rem; border: 1px solid var(--border-color, #444); border-radius: 4px; background: var(--bg-secondary, #1a1a1a); max-width: 36rem;">
  <h2 style="font-size: 1.1rem; margin-bottom: 0.5rem;">Request status</h2>
  {% if my_requests is defined and my_requests %}
  {% set ns = namespace(has_pending=false, latest_status=none) %}
  {% for r in my_requests %}{% if r.status == 'pending' %}{% set ns.has_pending = true %}{% endif %}{% if loop.first %}{% set ns.latest_status = r.status %}{% endif %}{% endfor %}
  <div style="padding: 0.5rem 0.75rem; border-radius: 4px; border: 1px solid var(--border-color, #444); margin-bottom: 0.75rem; display: inline-block;">
    <strong>Status:</strong>
    {% if ns.has_pending %}
    <span>Pending</span> — Waiting for Administrator approval
    {% else %}
    <span>{% if ns.latest_status == 'approved' %}Approved{% elif ns.latest_status == 'rejected' %}Disapproved{% else %}—{% endif %}</span>
    {% endif %}
  </div>
  <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.75rem;">Your time off requests. Status updates when Administrator approves or disapproves.</p>
  <table>
    <thead>
      <tr>
        <th>From</th>
        <th>To</th>
        <th>Type</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for r in my_requests %}
      <tr>
        <td>{{ r.from_date }}</td>
        <td>{{ r.to_date }}</td>
        <td>{{ r.notes }}</td>
        <td>
          {% if r.status == 'pending' %}Pending{% elif r.status == 'approved' %}Approved{% else %}Disapproved{% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p style="color: var(--text-muted); font-size: 0.9rem;">No time off requests yet. Submit a request above to see status here.</p>
  {% endif %}
</div>
{% endblock %}
