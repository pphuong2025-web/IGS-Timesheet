{% extends "base.html" %}
{% block title %}Time off calendar â€“ Admin{% endblock %}

{% block container_class %}container--wide{% endblock %}

{% block content %}
<header class="cal-page-header">
  <h1>Time Off Calendar</h1>
  <p class="cal-page-desc">Sick leave by employee for the month.</p>
  <nav class="cal-nav">
    <a href="{{ url_for('admin_timeoff_calendar', year=prev_year, month=prev_month) }}" class="btn btn-secondary">&larr; Previous month</a>
    <span class="cal-month-title">{{ month_name }} {{ year }}</span>
    <a href="{{ url_for('admin_timeoff_calendar', year=next_year, month=next_month) }}" class="btn btn-secondary">Next month &rarr;</a>
    <a href="{{ url_for('admin_timeoff') }}" class="btn">List view</a>
  </nav>
</header>

<div class="cal-wrap">
  <table class="timeoff-calendar">
    <thead>
      <tr>
        <th>Monday</th>
        <th>Tuesday</th>
        <th>Wednesday</th>
        <th>Thursday</th>
        <th>Friday</th>
        <th>Saturday</th>
        <th>Sunday</th>
      </tr>
    </thead>
    <tbody>
      {% for week in weeks %}
      <tr>
        {% for cell in week %}
        <td class="{% if cell and cell[0].isoformat() in conflict_dates %}cal-cell-conflict{% endif %}">
          {% if cell %}
          {% if cell[0].isoformat() in conflict_dates %}
          <div class="cal-flag" title="Two or more employees on the same shift have this day off">ðŸš© Shift conflict</div>
          {% endif %}
          <div class="cal-day-num">{{ cell[0].day }}</div>
          {% for item in cell[1] %}
          <div class="cal-timeoff" title="{{ item.notes }}">{{ item.full_name }} <span class="cal-type">({{ item.notes }})</span></div>
          {% endfor %}
          {% endif %}
        </td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<style>
  .cal-page-header { margin-bottom: 1.5rem; }
  .cal-page-header h1 { font-size: 1.75rem; margin-bottom: 0.35rem; letter-spacing: 0.02em; }
  .cal-page-desc { color: var(--text-muted); margin: 0 0 1rem 0; font-size: 0.95rem; }
  .cal-nav { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; }
  .cal-month-title { font-size: 1.25rem; font-weight: 600; min-width: 14rem; color: var(--text); }
  .cal-wrap { width: 100%; min-height: calc(100vh - 220px); display: flex; flex-direction: column; }
  .timeoff-calendar {
    border-collapse: collapse;
    table-layout: fixed;
    width: 100%;
    flex: 1;
    min-height: 400px;
    background: var(--surface);
    border-radius: 8px;
    overflow: hidden;
  }
  .timeoff-calendar thead th {
    border: 1px solid var(--border);
    padding: 0.75rem 0.5rem;
    text-align: center;
    font-weight: 600;
    font-size: 0.95rem;
    background: rgba(0,0,0,0.25);
    color: var(--text);
    width: 14.285%;
  }
  .timeoff-calendar tbody td {
    border: 1px solid var(--border);
    padding: 0.5rem;
    vertical-align: top;
    width: 14.285%;
    height: calc((100vh - 260px) / 6);
    min-height: 120px;
    max-height: calc((100vh - 260px) / 6);
    overflow: auto;
    box-sizing: border-box;
  }
  .cal-day-num { font-weight: 700; margin-bottom: 0.35rem; color: var(--text-muted); font-size: 0.9rem; }
  .cal-timeoff { font-size: 0.8rem; margin: 0.2rem 0; line-height: 1.3; }
  .cal-type { color: var(--text-muted); }
  .cal-cell-conflict { background: rgba(248, 81, 73, 0.12); border-color: var(--danger) !important; }
  .cal-flag { color: var(--danger); font-weight: 600; font-size: 0.8rem; margin-bottom: 0.25rem; }
</style>
{% endblock %}
